# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é –Ω–∞ –¥–æ–º–∞—à–Ω–∏–π —Å–µ—Ä–≤–µ—Ä

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ –ü–û

```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã (Ubuntu/Debian)
sudo apt update && sudo apt upgrade -y

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js (–≤–µ—Ä—Å–∏—è 18 –∏–ª–∏ –≤—ã—à–µ)
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL
sudo apt install -y postgresql postgresql-contrib

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PM2 –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏
sudo npm install -g pm2

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Nginx (–¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞)
sudo apt install -y nginx
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL

```bash
# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è postgres
sudo -u postgres psql

# –í –∫–æ–Ω—Å–æ–ª–∏ PostgreSQL:
CREATE DATABASE juyashop;
CREATE USER juyashop_user WITH PASSWORD 'your_secure_password';
GRANT ALL PRIVILEGES ON DATABASE juyashop TO juyashop_user;
\q
```

---

## –î–µ–ø–ª–æ–π Backend

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ/–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

```bash
# –°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞
mkdir -p /var/www/juyashop
cd /var/www/juyashop

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–æ–µ–∫—Ç (—á–µ—Ä–µ–∑ git, scp, –∏–ª–∏ rsync)
# –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
git clone <your-repo-url> .

# –ò–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ scp —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã:
# scp -r backend/ user@46.146.18.19:/var/www/juyashop/
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Backend

```bash
cd /var/www/juyashop/backend

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install

# –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞
nano .env
```

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ `.env` —Ñ–∞–π–ª–∞:**
```env
DATABASE_URL="postgresql://juyashop_user:your_secure_password@localhost:5432/juyashop"
JWT_SECRET="your-super-secret-jwt-key-change-in-production-min-32-chars"
JWT_EXPIRES_IN="7d"
PORT=3000
NODE_ENV=production
FRONTEND_URL="http://46.146.18.19"
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
cd /var/www/juyashop/backend

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Prisma Client
npx prisma generate

# –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π
npx prisma migrate deploy

# –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
npm run prisma:seed
```

### 4. –°–±–æ—Ä–∫–∞ Backend

```bash
cd /var/www/juyashop/backend

# –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
npm run build
```

### 5. –ó–∞–ø—É—Å–∫ Backend —á–µ—Ä–µ–∑ PM2

```bash
cd /var/www/juyashop/backend

# –°–æ–∑–¥–∞–Ω–∏–µ PM2 –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
nano ecosystem.config.js
```

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ `ecosystem.config.js`:**
```javascript
module.exports = {
  apps: [{
    name: 'juyashop-backend',
    script: 'dist/main.js',
    cwd: '/var/www/juyashop/backend',
    instances: 1,
    exec_mode: 'fork',
    env: {
      NODE_ENV: 'production',
      PORT: 3000
    },
    error_file: '/var/log/juyashop/backend-error.log',
    out_file: '/var/log/juyashop/backend-out.log',
    log_date_format: 'YYYY-MM-DD HH:mm:ss Z',
    merge_logs: true,
    autorestart: true,
    max_memory_restart: '1G'
  }]
};
```

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ª–æ–≥–æ–≤
sudo mkdir -p /var/log/juyashop
sudo chown $USER:$USER /var/log/juyashop

# –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ PM2
pm2 start ecosystem.config.js

# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ PM2
pm2 save

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ
pm2 startup
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É, –∫–æ—Ç–æ—Ä—É—é –≤—ã–≤–µ–¥–µ—Ç PM2
```

---

## –î–µ–ø–ª–æ–π Frontend

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Frontend

```bash
cd /var/www/juyashop/frontend

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install

# –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞
nano .env
```

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ `.env` —Ñ–∞–π–ª–∞:**
```env
VITE_API_URL=http://46.146.18.19:3000/api
```

### 2. –°–±–æ—Ä–∫–∞ Frontend

```bash
cd /var/www/juyashop/frontend

# –°–±–æ—Ä–∫–∞ –¥–ª—è production
npm run build
```

–ü–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏ —Ñ–∞–π–ª—ã –±—É–¥—É—Ç –≤ –ø–∞–ø–∫–µ `dist/`

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx
sudo nano /etc/nginx/sites-available/juyashop
```

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
```nginx
server {
    listen 80;
    server_name 46.146.18.19;  # –∏–ª–∏ –≤–∞—à –¥–æ–º–µ–Ω

    # Frontend (—Å—Ç–∞—Ç–∏—á–Ω—ã–µ —Ñ–∞–π–ª—ã)
    root /var/www/juyashop/frontend/dist;
    index index.html;

    # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
    access_log /var/log/nginx/juyashop-access.log;
    error_log /var/log/nginx/juyashop-error.log;

    # –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã
    location / {
        try_files $uri $uri/ /index.html;
    }

    # –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ API –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ backend
    location /api {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        
        # –í–∞–∂–Ω–æ –¥–ª—è cookies
        proxy_cookie_path / /;
    }

    # –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

```bash
# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo ln -s /etc/nginx/sites-available/juyashop /etc/nginx/sites-enabled/

# –£–¥–∞–ª–µ–Ω–∏–µ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
sudo rm /etc/nginx/sites-enabled/default

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo nginx -t

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ Nginx
sudo systemctl reload nginx
```

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Firewall

```bash
# –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤
sudo ufw allow 22/tcp    # SSH
sudo ufw allow 80/tcp   # HTTP
sudo ufw allow 443/tcp  # HTTPS (–µ—Å–ª–∏ –±—É–¥–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SSL)
sudo ufw enable
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Backend:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ PM2
pm2 status

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
pm2 logs juyashop-backend

# –ü—Ä–æ–≤–µ—Ä–∫–∞ API
curl http://localhost:3000/api/health
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Frontend:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Nginx
sudo systemctl status nginx

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
# –û—Ç–∫—Ä–æ–π—Ç–µ: http://46.146.18.19
```

---

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### PM2 –∫–æ–º–∞–Ω–¥—ã:
```bash
pm2 status              # –°—Ç–∞—Ç—É—Å –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
pm2 logs                # –õ–æ–≥–∏ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
pm2 logs juyashop-backend  # –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
pm2 restart juyashop-backend  # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
pm2 stop juyashop-backend     # –û—Å—Ç–∞–Ω–æ–≤–∫–∞
pm2 delete juyashop-backend   # –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ PM2
pm2 monit               # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞:
```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å backend
pm2 stop juyashop-backend

# 2. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ (git pull –∏–ª–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤)
cd /var/www/juyashop
git pull  # –∏–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã

# 3. Backend
cd backend
npm install
npm run build
npx prisma migrate deploy  # –µ—Å–ª–∏ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î
npx prisma generate

# 4. Frontend
cd ../frontend
npm install
npm run build

# 5. –ó–∞–ø—É—Å—Ç–∏—Ç—å backend
pm2 restart juyashop-backend

# 6. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å Nginx
sudo systemctl reload nginx
```

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL (HTTPS) - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ

### –ß–µ—Ä–µ–∑ Let's Encrypt (Certbot):

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Certbot
sudo apt install -y certbot python3-certbot-nginx

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω –∏–ª–∏ IP)
sudo certbot --nginx -d yourdomain.com

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
sudo certbot renew --dry-run
```

---

## –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞
pg_dump -U juyashop_user -d juyashop > backup_$(date +%Y%m%d).sql

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞
psql -U juyashop_user -d juyashop < backup_20240101.sql
```

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ PM2:
```bash
pm2 install pm2-logrotate
pm2 set pm2-logrotate:max_size 10M
pm2 set pm2-logrotate:retain 7
```

---

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### Backend –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
pm2 logs juyashop-backend

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Ä—Ç 3000 —Å–≤–æ–±–æ–¥–µ–Ω
sudo netstat -tulpn | grep 3000

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env —Ñ–∞–π–ª
cat /var/www/juyashop/backend/.env
```

### Frontend –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Nginx
sudo nginx -t
sudo systemctl status nginx

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
sudo chown -R www-data:www-data /var/www/juyashop/frontend/dist
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
psql -U juyashop_user -d juyashop -h localhost

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω
sudo systemctl status postgresql
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```
/var/www/juyashop/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ dist/              # –°–æ–±—Ä–∞–Ω–Ω—ã–π backend
‚îÇ   ‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ .env
‚îÇ   ‚îú‚îÄ‚îÄ ecosystem.config.js
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îú‚îÄ‚îÄ dist/              # –°–æ–±—Ä–∞–Ω–Ω—ã–π frontend (–æ—Ç–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ Nginx)
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ logs/                  # –õ–æ–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

---

## –ì–æ—Ç–æ–≤–æ! üéâ

–í–∞—à –ø—Ä–æ–µ–∫—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:
- Frontend: http://46.146.18.19
- Backend API: http://46.146.18.19/api

